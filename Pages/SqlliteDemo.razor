@page "/SqlliteDemo"

@using Microsoft.EntityFrameworkCore
@using TheWallet.Data
@using TheWallet.Models


<PageTitle>Sqllite Demo</PageTitle>

@code {
  [Inject]
  private IDbContextFactory<TheWalletDBContext> _dbContextFactory { get; set; } = default!;

  protected override async Task OnInitializedAsync()
  {
    await using var db = await _dbContextFactory.CreateDbContextAsync();
    await db.Database.EnsureCreatedAsync();

    // create seed data
    if (!db.Finances.Any())
    {
      var Finances = new[]
      {
        new Finance { Amount = 1000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now },
        new Finance { Amount = 2000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now },
        new Finance { Amount = 3000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now },
        new Finance { Amount = 4000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now },
        new Finance { Amount = 5000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now },
        new Finance { Amount = 6000, CreateDate = DateTime.Now, UpdateDate = DateTime.Now }
      };

      await db.Finances.AddRangeAsync(Finances);
      await db.SaveChangesAsync();
    }

    await base.OnInitializedAsync();
  }
}